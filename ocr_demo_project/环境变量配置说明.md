# ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜

## ğŸ“‹ é…ç½®æ–‡ä»¶ä½ç½®

ä½ çš„ä»£ç ä» **`.env`** æ–‡ä»¶è¯»å–æ‰€æœ‰APIé…ç½®ã€‚

## âœ… å½“å‰ä»£ç å¦‚ä½•è¯»å–é…ç½®

### 1. LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰- `LLM.py`

```python
# ç¬¬14-15è¡Œï¼šè‡ªåŠ¨æŸ¥æ‰¾å¹¶åŠ è½½.envæ–‡ä»¶
from dotenv import load_dotenv, find_dotenv
_ = load_dotenv(find_dotenv())

# ç¬¬45-47è¡Œï¼šè¯»å–ç¯å¢ƒå˜é‡
llm = ChatOpenAI(
    model_name= os.getenv("CLOUD_MODEL"),        # â† ä».envè¯»å–
    openai_api_key=os.getenv("CLOUD_API_KEY"),   # â† ä».envè¯»å–
    openai_api_base=os.getenv("CLOUD_BASE_URL"), # â† ä».envè¯»å–
)
```

### 2. Embeddingï¼ˆå‘é‡æ¨¡å‹ï¼‰- `Embeddings.py`

```python
# ç¬¬15-16è¡Œï¼šåŠ è½½.envæ–‡ä»¶
from dotenv import load_dotenv, find_dotenv
_ = load_dotenv(find_dotenv())

# ç¬¬87-88, 90è¡Œï¼šè¯»å–ç¯å¢ƒå˜é‡
self.client.api_key = os.getenv("OPENAI_API_KEY")    # â† ä».envè¯»å–
self.client.base_url = os.getenv("OPENAI_BASE_URL")  # â† ä».envè¯»å–
model = os.getenv("OPENAI_API_MODEL")                 # â† ä».envè¯»å–
```

---

## ğŸ”§ éœ€è¦åœ¨.envä¸­é…ç½®çš„å˜é‡

åœ¨ `/home/honglianglu/ssd/casco/project/.env` æ–‡ä»¶ä¸­éœ€è¦é…ç½®ï¼š

```bash
# ==========================================
# LLM é…ç½®ï¼ˆç”¨äºç”Ÿæˆç­”æ¡ˆï¼‰
# ==========================================
CLOUD_MODEL=deepseek-chat                    # æ¨¡å‹åç§°
CLOUD_API_KEY=sk-your-api-key-here          # ä½ çš„APIå¯†é’¥
CLOUD_BASE_URL=https://api.deepseek.com/v1  # APIåœ°å€

# ==========================================
# Embedding é…ç½®ï¼ˆç”¨äºå‘é‡æ£€ç´¢ï¼‰
# ==========================================
OPENAI_API_MODEL=BAAI/bge-large-zh-v1.5              # Embeddingæ¨¡å‹
OPENAI_API_KEY=your-embedding-api-key-here           # Embedding APIå¯†é’¥
OPENAI_BASE_URL=https://your-embedding-service.com/v1 # Embedding APIåœ°å€
```

---

## ğŸ¯ æ¨èé…ç½®æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šDeepSeek + OpenAI Embedding

```bash
# LLM: DeepSeekï¼ˆæ€§ä»·æ¯”é«˜ï¼Œä¸­æ–‡æ•ˆæœå¥½ï¼‰
CLOUD_MODEL=deepseek-chat
CLOUD_API_KEY=sk-your-deepseek-key
CLOUD_BASE_URL=https://api.deepseek.com/v1

# Embedding: OpenAI
OPENAI_API_MODEL=text-embedding-3-small
OPENAI_API_KEY=sk-your-openai-key
OPENAI_BASE_URL=https://api.openai.com/v1
```

### æ–¹æ¡ˆ2ï¼šé€šä¹‰åƒé—® + æœ¬åœ°EmbeddingæœåŠ¡

```bash
# LLM: é€šä¹‰åƒé—®
CLOUD_MODEL=qwen-turbo
CLOUD_API_KEY=sk-your-qwen-key
CLOUD_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1

# Embedding: BGEï¼ˆé€šè¿‡OpenAIå…¼å®¹æ¥å£ï¼‰
OPENAI_API_MODEL=BAAI/bge-large-zh-v1.5
OPENAI_API_KEY=your-key
OPENAI_BASE_URL=http://localhost:8000/v1
```

### æ–¹æ¡ˆ3ï¼šæ™ºè°±AI GLM

```bash
# LLM: GLM-4
CLOUD_MODEL=glm-4
CLOUD_API_KEY=your-zhipu-key
CLOUD_BASE_URL=https://open.bigmodel.cn/api/paas/v4

# Embedding: æ™ºè°±Embedding
OPENAI_API_MODEL=embedding-2
OPENAI_API_KEY=your-zhipu-key
OPENAI_BASE_URL=https://open.bigmodel.cn/api/paas/v4
```

---

## ğŸ” å¦‚ä½•æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®

### æ–¹æ³•1ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬

```bash
cd /home/honglianglu/ssd/casco/project

# æµ‹è¯•LLMé…ç½®
python -c "
from LLM import OpenAIChat
from dotenv import load_dotenv, find_dotenv
import os

load_dotenv(find_dotenv())
print('LLMé…ç½®:')
print(f'  æ¨¡å‹: {os.getenv(\"CLOUD_MODEL\")}')
print(f'  API KEY: {os.getenv(\"CLOUD_API_KEY\")[:20]}...')
print(f'  BASE URL: {os.getenv(\"CLOUD_BASE_URL\")}')

chat = OpenAIChat()
response = chat.chat('ä½ å¥½', [], 'æµ‹è¯•ä¸Šä¸‹æ–‡')
print(f'\\næµ‹è¯•å“åº”: {response}')
"

# æµ‹è¯•Embeddingé…ç½®
python -c "
from Embeddings import OpenAIEmbedding
from dotenv import load_dotenv, find_dotenv
import os

load_dotenv(find_dotenv())
print('\\nEmbeddingé…ç½®:')
print(f'  æ¨¡å‹: {os.getenv(\"OPENAI_API_MODEL\")}')
print(f'  API KEY: {os.getenv(\"OPENAI_API_KEY\")[:20]}...')
print(f'  BASE URL: {os.getenv(\"OPENAI_BASE_URL\")}')

embedding = OpenAIEmbedding()
vector = embedding.get_embedding('æµ‹è¯•æ–‡æœ¬')
print(f'\\nå‘é‡ç»´åº¦: {len(vector)}')
print(f'å‘é‡å‰5ä¸ªå€¼: {vector[:5]}')
"
```

### æ–¹æ³•2ï¼šç›´æ¥è¿è¡Œdemo.py

```bash
python demo.py
```

å¦‚æœé…ç½®æ­£ç¡®ï¼Œä¼šæˆåŠŸæ‰§è¡ŒæŸ¥è¯¢ï¼›å¦‚æœé…ç½®æœ‰é—®é¢˜ï¼Œä¼šæŠ¥é”™æç¤ºç¼ºå°‘å“ªä¸ªç¯å¢ƒå˜é‡ã€‚

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šæ‰¾ä¸åˆ°.envæ–‡ä»¶

**é”™è¯¯ä¿¡æ¯ï¼š** ä»£ç è¿è¡Œä½†ä½¿ç”¨Noneä½œä¸ºAPI key

**è§£å†³æ–¹æ³•ï¼š**
```bash
# ç¡®ä¿.envæ–‡ä»¶åœ¨æ­£ç¡®çš„ä½ç½®
ls -la /home/honglianglu/ssd/casco/project/.env

# å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ
touch /home/honglianglu/ssd/casco/project/.env
```

### é—®é¢˜2ï¼šAPIå¯†é’¥æ— æ•ˆ

**é”™è¯¯ä¿¡æ¯ï¼š** `401 Unauthorized` æˆ– `Invalid API key`

**è§£å†³æ–¹æ³•ï¼š**
- æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®å¤åˆ¶ï¼ˆæ²¡æœ‰å¤šä½™ç©ºæ ¼ï¼‰
- ç¡®è®¤APIå¯†é’¥æ˜¯å¦å·²æ¿€æ´»
- æ£€æŸ¥BASE_URLæ˜¯å¦æ­£ç¡®

### é—®é¢˜3ï¼šæ¨¡å‹åç§°é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š** `Model not found`

**è§£å†³æ–¹æ³•ï¼š**
- æ£€æŸ¥CLOUD_MODELæ˜¯å¦ä¸ä½ çš„APIæœåŠ¡æ”¯æŒçš„æ¨¡å‹åç§°ä¸€è‡´
- å¸¸è§æ¨¡å‹åç§°ï¼š
  - DeepSeek: `deepseek-chat`
  - OpenAI: `gpt-3.5-turbo`, `gpt-4`
  - é€šä¹‰åƒé—®: `qwen-turbo`, `qwen-plus`
  - GLM: `glm-4`, `glm-3-turbo`

### é—®é¢˜4ï¼šEmbeddingç»´åº¦ä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯ï¼š** å‘é‡åº“åŠ è½½å¤±è´¥

**è§£å†³æ–¹æ³•ï¼š**
- ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„Embeddingæ¨¡å‹æ¥ç”Ÿæˆå’ŒæŸ¥è¯¢
- å¦‚æœæ›´æ¢äº†Embeddingæ¨¡å‹ï¼Œéœ€è¦é‡æ–°æ„å»ºå‘é‡åº“ï¼š
  ```bash
  python run_competition.py --rebuild
  ```

---

## ğŸ“ .env æ–‡ä»¶ç¤ºä¾‹ï¼ˆä¾›å‚è€ƒï¼‰

åˆ›å»ºæ–‡ä»¶ï¼š`/home/honglianglu/ssd/casco/project/.env`

```bash
# LLMé…ç½®
CLOUD_MODEL=deepseek-chat
CLOUD_API_KEY=sk-1234567890abcdefghijklmnopqrstuvwxyz
CLOUD_BASE_URL=https://api.deepseek.com/v1

# Embeddingé…ç½®
OPENAI_API_MODEL=BAAI/bge-large-zh-v1.5
OPENAI_API_KEY=sk-9876543210zyxwvutsrqponmlkjihgfedcba
OPENAI_BASE_URL=https://api.your-service.com/v1
```

**æ³¨æ„ï¼š**
- ä¸è¦å°†.envæ–‡ä»¶æäº¤åˆ°Git
- .envå·²åœ¨.gitignoreä¸­ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œè¯·æ·»åŠ ï¼‰
- APIå¯†é’¥è¦ä¿å¯†

---

## âœ… éªŒè¯æ­¥éª¤

1. **æ£€æŸ¥.envæ–‡ä»¶æ˜¯å¦å­˜åœ¨**
   ```bash
   cat /home/honglianglu/ssd/casco/project/.env
   ```

2. **æµ‹è¯•é…ç½®æ˜¯å¦èƒ½è¯»å–**
   ```bash
   cd /home/honglianglu/ssd/casco/project
   python -c "from dotenv import load_dotenv, find_dotenv; import os; load_dotenv(find_dotenv()); print('CLOUD_MODEL:', os.getenv('CLOUD_MODEL'))"
   ```

3. **è¿è¡Œå®Œæ•´æµ‹è¯•**
   ```bash
   python demo.py
   ```

---

## ğŸ¯ ç«èµ›å»ºè®®

æ ¹æ®è¯„æµ‹ç»´åº¦é€‰æ‹©åˆé€‚çš„æ¨¡å‹ï¼š

| è¯„æµ‹ç»´åº¦ | æ¨èé€‰æ‹© | åŸå›  |
|---------|---------|------|
| **ç­”æ¡ˆè´¨é‡** | DeepSeek-V2, GPT-4 | æ¨ç†èƒ½åŠ›å¼º |
| **Tokenæ•ˆç‡** | Qwen-Turbo, GPT-3.5 | ç”Ÿæˆç®€æ´ |
| **å‚æ•°é‡** | Qwen2.5-7B, Llama3-8B | å‚æ•°é€‚ä¸­ |
| **ç»¼åˆæ€§ä»·æ¯”** | DeepSeek-Chat | è´¨é‡å¥½ä¸”ä¾¿å®œ |

**Embeddingæ¨¡å‹å»ºè®®ï¼š**
- **ä¸­æ–‡ä¼˜å…ˆï¼š** `BAAI/bge-large-zh-v1.5`ï¼ˆä¸“é—¨é’ˆå¯¹ä¸­æ–‡ä¼˜åŒ–ï¼‰
- **é€šç”¨æ–¹æ¡ˆï¼š** `text-embedding-3-small`ï¼ˆOpenAIï¼Œæ•ˆæœç¨³å®šï¼‰
- **æœ¬åœ°éƒ¨ç½²ï¼š** ä¸‹è½½BGEæ¨¡å‹åˆ°æœ¬åœ°ï¼Œé™ä½æˆæœ¬

---

## ğŸ’¡ æ€»ç»“

âœ… **æ˜¯çš„ï¼Œä½ çš„ä»£ç å®Œå…¨ä½¿ç”¨.envé…ç½®æ–‡ä»¶**

- `load_dotenv(find_dotenv())` ä¼šè‡ªåŠ¨æŸ¥æ‰¾å¹¶åŠ è½½.envæ–‡ä»¶
- LLMä½¿ç”¨ï¼š`CLOUD_MODEL`, `CLOUD_API_KEY`, `CLOUD_BASE_URL`
- Embeddingä½¿ç”¨ï¼š`OPENAI_API_MODEL`, `OPENAI_API_KEY`, `OPENAI_BASE_URL`
- ä¿®æ”¹.envæ–‡ä»¶åï¼Œé‡å¯ç¨‹åºå³å¯ç”Ÿæ•ˆ
- ä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œåªéœ€è¦é…ç½®.envæ–‡ä»¶

å¦‚æœä½ æƒ³æŸ¥çœ‹å½“å‰é…ç½®çš„å…·ä½“å†…å®¹ï¼Œå¯ä»¥è¿è¡Œï¼š
```bash
cd /home/honglianglu/ssd/casco/project
cat .env
```

